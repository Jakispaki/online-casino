{% extends "base.html" %}

{% block content %}
<style>
  body {
    background: radial-gradient(circle at top, #0b1224, #05070d 55%, #030407 100%);
    color: #e8e8e8;
  }
  :root {
    --felt-color: #0b1b14;
    --felt-border: #1f3b2c;
    --chip-glow: rgba(240, 192, 97, 0.6);
  }
  .roulette-wrapper {
    max-width: 1100px;
    margin: 24px auto 60px;
    padding: 0 16px;
  }
  .casino-topbar {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    align-items: center;
    gap: 12px;
    background: #0f162b;
    border: 1px solid rgba(255, 215, 130, 0.18);
    border-radius: 14px;
    padding: 12px 16px;
    box-shadow: 0 10px 22px rgba(0, 0, 0, 0.35);
  }
  .casino-title {
    font-size: 18px;
    font-weight: 700;
    letter-spacing: 0.4px;
  }
  .balance-pill {
    background: #0b1122;
    border: 1px solid #28314e;
    border-radius: 999px;
    padding: 6px 16px;
    font-weight: 700;
    color: #f0c061;
  }
  .topbar-actions {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
  }
  .icon-btn {
    background: #0b1122;
    border: 1px solid #28314e;
    color: #cdd2e2;
    padding: 8px 12px;
    border-radius: 10px;
    font-weight: 600;
  }
  .tutorial-btn {
    border-color: rgba(240, 192, 97, 0.6);
    color: #f0c061;
  }
  .table-area {
    margin-top: 22px;
    background: var(--felt-color);
    border: 2px solid var(--felt-border);
    border-radius: 22px;
    padding: 22px 18px 26px;
    box-shadow: inset 0 0 40px rgba(0, 0, 0, 0.5);
  }
  .roulette-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 18px;
  }
  .wheel-container {
    position: relative;
    width: 220px;
    height: 220px;
    margin: 0 auto;
  }
  .wheel {
    width: 220px;
    height: 220px;
    border-radius: 50%;
    background: conic-gradient(
      #1f2a49 0deg 10deg,
      #b31313 10deg 20deg,
      #121826 20deg 30deg,
      #b31313 30deg 40deg,
      #121826 40deg 50deg,
      #b31313 50deg 60deg,
      #121826 60deg 70deg,
      #b31313 70deg 80deg,
      #121826 80deg 90deg,
      #b31313 90deg 100deg,
      #121826 100deg 110deg,
      #b31313 110deg 120deg,
      #121826 120deg 130deg,
      #b31313 130deg 140deg,
      #121826 140deg 150deg,
      #b31313 150deg 160deg,
      #121826 160deg 170deg,
      #b31313 170deg 180deg,
      #121826 180deg 190deg,
      #b31313 190deg 200deg,
      #121826 200deg 210deg,
      #b31313 210deg 220deg,
      #121826 220deg 230deg,
      #b31313 230deg 240deg,
      #121826 240deg 250deg,
      #b31313 250deg 260deg,
      #121826 260deg 270deg,
      #b31313 270deg 280deg,
      #121826 280deg 290deg,
      #b31313 290deg 300deg,
      #121826 300deg 310deg,
      #b31313 310deg 320deg,
      #121826 320deg 330deg,
      #b31313 330deg 340deg,
      #121826 340deg 350deg,
      #b31313 350deg 360deg
    );
    border: 6px solid #111827;
    position: relative;
    transition: transform 1.5s ease-out;
  }
  .wheel-numbers {
    position: absolute;
    inset: 0;
    pointer-events: none;
  }
  .wheel-number {
    position: absolute;
    width: 20px;
    height: 20px;
    font-size: 10px;
    font-weight: 700;
    color: #f8f1e1;
    text-shadow: 0 0 6px rgba(0,0,0,0.6);
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .wheel::after {
    content: '';
    width: 12px;
    height: 12px;
    background: #f0c061;
    border-radius: 50%;
    position: absolute;
    top: -6px;
    left: 50%;
    transform: translateX(-50%);
  }
  .wheel.spinning {
    transform: rotate(var(--spin-deg));
  }
  .status-bar {
    background: rgba(11, 17, 34, 0.7);
    border: 1px solid #28314e;
    border-radius: 14px;
    padding: 12px 16px;
    margin-top: 12px;
    font-weight: 600;
    color: #cdd2e2;
  }
  .winning-number {
    display: inline-block;
    font-size: 26px;
    font-weight: 800;
    color: #f0c061;
  }
  .table-grid {
    display: grid;
    grid-template-columns: 80px 1fr;
    gap: 12px;
    margin-top: 18px;
  }
  .zero-cell {
    background: #0f3f2f;
    border: 1px solid #1f6b53;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 18px;
    color: #e8f8ef;
    min-height: 264px;
    position: relative;
  }
  .bet-cell {
    background: #101826;
    border: 1px solid #1f2a49;
    border-radius: 8px;
    padding: 6px 4px;
    text-align: center;
    color: #f1f1f1;
    font-size: 12px;
    font-weight: 600;
    position: relative;
    cursor: pointer;
    transition: transform 0.15s ease, box-shadow 0.15s ease;
  }
  .bet-cell.red { background: #4b1111; border-color: #7a1111; }
  .bet-cell.black { background: #0e0e14; border-color: #242b3b; }
  .bet-cell.green { background: #0f3f2f; border-color: #1f6b53; }
  .bet-cell:hover {
    transform: translateY(-2px);
    box-shadow: 0 0 12px rgba(0,0,0,0.4);
  }
  .bet-cell .bet-amount {
    position: absolute;
    bottom: 4px;
    right: 6px;
    background: #f0c061;
    color: #111;
    border-radius: 999px;
    padding: 2px 6px;
    font-size: 10px;
    display: none;
    box-shadow: 0 0 12px var(--chip-glow);
  }
  .bet-cell.placed .bet-amount { display: inline-block; }
  .bet-cell.placed { animation: chip-pop 0.2s ease; }
  .bet-cell.win {
    box-shadow: 0 0 14px rgba(240, 192, 97, 0.75);
    border-color: #f0c061;
  }
  @keyframes chip-pop {
    0% { transform: scale(0.95); }
    100% { transform: scale(1); }
  }
  .numbers-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 6px;
  }
  .outside-bets {
    display: grid;
    grid-template-columns: repeat(6, 1fr);
    gap: 6px;
    margin-top: 10px;
  }
  .dozen-row,
  .column-row {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 6px;
    margin-top: 10px;
  }
  .chips-bar {
    margin-top: 18px;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    align-items: center;
    justify-content: space-between;
  }
  .chips {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }
  .chip {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    border: 2px solid #f0c061;
    background: #1a1f2f;
    color: #f0c061;
    font-weight: 700;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 0 12px rgba(0,0,0,0.4);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }
  .chip.active {
    transform: translateY(-2px);
    box-shadow: 0 0 16px var(--chip-glow);
  }
  .btn-auth {
    background: linear-gradient(135deg, #d8a748, #b9801f);
    border: none;
    color: #111;
    font-weight: 700;
    padding: 10px 18px;
    border-radius: 10px;
  }
  .btn-primary {
    background: linear-gradient(135deg, #f0c061, #d8a748);
    box-shadow: 0 0 16px rgba(240, 192, 97, 0.6);
  }
  .btn-ghost {
    background: #0b1122;
    border: 1px solid #28314e;
    color: #cdd2e2;
    padding: 10px 16px;
    border-radius: 10px;
    font-weight: 600;
  }
  .side-panel {
    background: rgba(11, 17, 34, 0.7);
    border: 1px solid #28314e;
    border-radius: 14px;
    padding: 14px;
    margin-top: 18px;
  }
  .side-panel h4 { margin-top: 0; }
  .bet-guide {
    background: linear-gradient(135deg, rgba(15, 22, 43, 0.9), rgba(11, 17, 34, 0.7));
    border: 1px solid rgba(240, 192, 97, 0.3);
    box-shadow: inset 0 0 18px rgba(0, 0, 0, 0.35);
  }
  .bet-guide h4 {
    color: #f0c061;
    letter-spacing: 0.6px;
  }
  .bet-guide-list {
    list-style: none;
    padding: 0;
    margin: 8px 0 0;
    display: grid;
    grid-template-columns: 1fr;
    gap: 8px;
    font-size: 14px;
    line-height: 1.5;
    color: #cdd2e2;
  }
  .bet-guide-list span {
    color: #f0c061;
    font-weight: 700;
  }
  .history {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
  }
  .history span {
    padding: 4px 8px;
    border-radius: 999px;
    font-size: 11px;
    background: #1f2a49;
  }
  .history .red { background: #7a1111; }
  .history .black { background: #121826; }
  .history .green { background: #1f6b53; }
  .footer-note {
    margin-top: 18px;
    font-size: 12px;
    color: #9aa2ba;
    text-align: center;
  }
  .tutorial-overlay {
    position: fixed;
    inset: 0;
    background: rgba(3, 4, 7, 0.85);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 2000;
  }
  .tutorial-card {
    background: #0f162b;
    border: 1px solid rgba(255, 215, 130, 0.2);
    border-radius: 14px;
    padding: 20px;
    max-width: 420px;
    text-align: center;
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.5);
  }
  .tutorial-card h3 {
    margin-top: 0;
    font-size: 20px;
    font-weight: 700;
  }
  .tutorial-actions {
    margin-top: 16px;
    display: flex;
    justify-content: center;
    gap: 10px;
    flex-wrap: wrap;
  }
  .tutorial-actions button {
    border-radius: 10px;
    padding: 8px 14px;
    border: none;
    font-weight: 700;
  }
  .btn-tutorial {
    background: #f0c061;
    color: #111;
  }
  .btn-skip {
    background: #0b1122;
    border: 1px solid #28314e;
    color: #cdd2e2;
  }
  @media (min-width: 900px) {
    .roulette-grid {
      grid-template-columns: 1.1fr 1.4fr;
      align-items: start;
    }
  }
</style>

<div class="roulette-wrapper">
  <div class="casino-topbar">
    <div class="casino-title">Royal Ace Roulette</div>
    <div class="balance-pill"><span data-i18n="ui.balance">Balance</span>: $<span id="balance">{{ "%.2f"|format(balance) }}</span></div>
    <div class="topbar-actions">
      <a class="icon-btn" data-i18n="ui.settings" href="{{ url_for('settings') }}">Settings</a>
      <a class="icon-btn" data-i18n="ui.help" href="{{ url_for('help_page') }}">Help</a>
      <button class="icon-btn tutorial-btn" id="tutorial-btn" type="button">Tutorial</button>
    </div>
  </div>

  <div class="table-area">
    <div class="roulette-grid">
      <div style="text-align:center;">
        <div class="wheel-container">
          <div class="wheel" id="wheel"></div>
          <div class="wheel-numbers" id="wheel-numbers"></div>
        </div>
        <div id="message" class="status-bar">Place your bets.</div>
        <div id="spin-result" class="status-bar" style="display:none;"></div>
      </div>

      <div>
        <div class="table-grid">
          <div class="zero-cell bet-cell green" data-type="number" data-value="0">0<span class="bet-amount"></span></div>
          <div>
            {% set red_numbers = [1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36] %}
            <div class="numbers-grid">
              {% for n in range(1, 37) %}
                <div class="bet-cell {% if n in red_numbers %}red{% else %}black{% endif %}" data-type="number" data-value="{{ n }}">
                  {{ n }}
                  <span class="bet-amount"></span>
                </div>
              {% endfor %}
            </div>

            <div class="outside-bets">
              <div class="bet-cell" data-type="range" data-value="low">1-18<span class="bet-amount"></span></div>
              <div class="bet-cell" data-type="parity" data-value="even">Even<span class="bet-amount"></span></div>
              <div class="bet-cell red" data-type="color" data-value="red">Red<span class="bet-amount"></span></div>
              <div class="bet-cell black" data-type="color" data-value="black">Black<span class="bet-amount"></span></div>
              <div class="bet-cell" data-type="parity" data-value="odd">Odd<span class="bet-amount"></span></div>
              <div class="bet-cell" data-type="range" data-value="high">19-36<span class="bet-amount"></span></div>
            </div>

            <div class="dozen-row">
              <div class="bet-cell" data-type="dozen" data-value="1st">1st 12<span class="bet-amount"></span></div>
              <div class="bet-cell" data-type="dozen" data-value="2nd">2nd 12<span class="bet-amount"></span></div>
              <div class="bet-cell" data-type="dozen" data-value="3rd">3rd 12<span class="bet-amount"></span></div>
            </div>

            <div class="column-row">
              <div class="bet-cell" data-type="column" data-value="1">Column 1<span class="bet-amount"></span></div>
              <div class="bet-cell" data-type="column" data-value="2">Column 2<span class="bet-amount"></span></div>
              <div class="bet-cell" data-type="column" data-value="3">Column 3<span class="bet-amount"></span></div>
            </div>
          </div>
        </div>

        <div class="chips-bar">
          <div class="chips">
            <div class="chip" data-value="1">$1</div>
            <div class="chip" data-value="5">$5</div>
            <div class="chip" data-value="10">$10</div>
            <div class="chip" data-value="25">$25</div>
            <div class="chip" data-value="100">$100</div>
          </div>
          <div style="display:flex; gap:10px; flex-wrap:wrap;">
            <button class="btn-ghost" id="clear-bet" type="button">Clear Bet</button>
            <button class="btn-auth btn-primary" id="spin-btn" type="button">Spin Wheel</button>
          </div>
        </div>

        <div class="side-panel">
          <h4>Current bets</h4>
          <div id="current-bets" style="font-size:13px; color:#cdd2e2;">No bets placed.</div>
        </div>

        <div class="side-panel">
          <h4>Recent numbers</h4>
          <div class="history" id="history"></div>
        </div>

        <div class="side-panel">
          <h4>Personal best</h4>
          <p style="margin:0; font-size:13px; color:#cdd2e2;">Highest balance: ${{ "%.2f"|format(best_balance) }}</p>
          <p style="margin:0; font-size:13px; color:#cdd2e2;">Longest win streak: {{ max_streak }}</p>
          <p style="margin:0; font-size:13px; color:#cdd2e2;">Most wins: {{ most_wins }}</p>
        </div>

        <div class="side-panel bet-guide">
          <h4>Bet guide</h4>
          <ul class="bet-guide-list">
            <li><span>1st 12</span> numbers 1-12</li>
            <li><span>2nd 12</span> numbers 13-24</li>
            <li><span>3rd 12</span> numbers 25-36</li>
            <li><span>Column 1</span> 1,4,7,...,34</li>
            <li><span>Column 2</span> 2,5,8,...,35</li>
            <li><span>Column 3</span> 3,6,9,...,36</li>
            <li><span>1-18 / 19-36</span> low or high</li>
            <li><span>Odd / Even</span> parity</li>
            <li><span>Red / Black</span> color</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <p class="footer-note">18+ only. Please gamble responsibly. This is a demo environment.</p>
</div>

  <div class="tutorial-overlay" id="tutorial-overlay" data-show="{{ 'true' if show_tutorial else 'false' }}">
  <div class="tutorial-card">
    <h3 id="tutorial-title">Welcome to Roulette</h3>
    <p id="tutorial-text">Select a chip value, then tap a bet area.</p>
    <div class="tutorial-actions">
      <button class="btn-skip" id="tutorial-close">Close</button>
      <button class="btn-tutorial" id="tutorial-next">Next</button>
    </div>
  </div>
</div>

<script>
  const wheel = document.getElementById('wheel');
  const wheelNumbers = document.getElementById('wheel-numbers');
  const resultBox = document.getElementById('spin-result');
  const messageBox = document.getElementById('message');
  const historyBox = document.getElementById('history');
  const currentBetsBox = document.getElementById('current-bets');
  const betCells = document.querySelectorAll('.bet-cell');
  const chips = document.querySelectorAll('.chip');
  const bets = {};
  let selectedChip = 10;

  function renderWheelNumbers() {
    const radius = 96;
    const center = 110;
    const numbers = [0, 32, 15, 19, 4, 21, 2, 25, 17, 34, 6, 27, 13, 36, 11, 30, 8, 23, 10, 5, 24, 16, 33, 1, 20, 14, 31, 9, 22, 18, 29, 7, 28, 12, 35, 3, 26];
    wheelNumbers.innerHTML = '';
    numbers.forEach((num, i) => {
      const angle = (i / numbers.length) * 2 * Math.PI - Math.PI / 2;
      const x = center + radius * Math.cos(angle) - 10;
      const y = center + radius * Math.sin(angle) - 10;
      const el = document.createElement('div');
      el.className = 'wheel-number';
      el.style.left = `${x}px`;
      el.style.top = `${y}px`;
      el.textContent = num;
      wheelNumbers.appendChild(el);
    });
  }

  const SETTINGS_KEY = 'casino_settings';
  const themeMap = {
    green: { felt: '#0b1b14', border: '#1f3b2c' },
    blue: { felt: '#0b1224', border: '#23345d' },
    red: { felt: '#241011', border: '#4e1b1f' }
  };

  function applySettings() {
    const raw = localStorage.getItem(SETTINGS_KEY);
    if (!raw) return;
    try {
      const settings = JSON.parse(raw);
      const theme = themeMap[settings.theme] || themeMap.green;
      document.documentElement.style.setProperty('--felt-color', theme.felt);
      document.documentElement.style.setProperty('--felt-border', theme.border);
    } catch {
      return;
    }
  }

  applySettings();
  renderWheelNumbers();
  {
    const t = window.getTranslation || ((key, fallback) => fallback || key);
    messageBox.textContent = t('roulette.placeBets', 'Place your bets.');
  }

  chips.forEach(chip => {
    chip.addEventListener('click', () => {
      chips.forEach(c => c.classList.remove('active'));
      chip.classList.add('active');
      selectedChip = parseFloat(chip.dataset.value);
    });
  });
  chips[2].classList.add('active');

  betCells.forEach(cell => {
    cell.addEventListener('click', () => {
      const key = `${cell.dataset.type}:${cell.dataset.value}`;
      bets[key] = (bets[key] || 0) + selectedChip;
      cell.classList.add('placed');
      cell.querySelector('.bet-amount').textContent = `$${bets[key].toFixed(0)}`;
      updateCurrentBets();
    });
  });

  function updateCurrentBets() {
    const entries = Object.entries(bets);
    if (!entries.length) {
      const t = window.getTranslation || ((key, fallback) => fallback || key);
      currentBetsBox.textContent = t('roulette.noBets', 'No bets placed.');
      return;
    }
    currentBetsBox.innerHTML = entries.map(([k, v]) => {
      const [type, value] = k.split(':');
      return `<div>${type} ${value}: $${v.toFixed(0)}</div>`;
    }).join('');
  }

  function clearBets() {
    for (const key of Object.keys(bets)) {
      delete bets[key];
    }
    betCells.forEach(cell => {
      cell.classList.remove('placed', 'win');
      cell.querySelector('.bet-amount').textContent = '';
    });
    updateCurrentBets();
    const t = window.getTranslation || ((key, fallback) => fallback || key);
    messageBox.textContent = t('roulette.placeBets', 'Place your bets.');
    resultBox.style.display = 'none';
  }

  document.getElementById('clear-bet').addEventListener('click', clearBets);

  function spinWheel() {
    const betEntries = Object.entries(bets).map(([k, amount]) => {
      const [type, value] = k.split(':');
      return { type, value, amount };
    });

    if (!betEntries.length) {
      const t = window.getTranslation || ((key, fallback) => fallback || key);
      messageBox.textContent = t('roulette.needBet', 'Please place at least one bet.');
      return;
    }

    betCells.forEach(cell => cell.classList.remove('win'));

    const rotation = 1440 + Math.floor(Math.random() * 360);
    wheel.style.setProperty('--spin-deg', `${rotation}deg`);
    wheel.classList.remove('spinning');
    void wheel.offsetWidth;
    wheel.classList.add('spinning');

    fetch('/roulette/spin', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ bets: betEntries })
    })
      .then(r => r.json())
      .then(data => {
        if (data.error) {
          messageBox.textContent = data.error;
          return;
        }
        document.getElementById('balance').textContent = data.balance.toFixed(2);
        const winText = data.payout > 0 ? `You win $${data.payout.toFixed(2)}` : 'No win this round.';
        resultBox.style.display = 'block';
        resultBox.innerHTML = `Winning number: <span class="winning-number">${data.result_number}</span> (${data.result_color}). ${winText}`;
        const t = window.getTranslation || ((key, fallback) => fallback || key);
        messageBox.textContent = t('roulette.nextRound', 'Place your bets for the next round.');

        highlightWinners(data);
        pushHistory(data.result_number, data.result_color);
      })
      .catch(() => {
        const t = window.getTranslation || ((key, fallback) => fallback || key);
        messageBox.textContent = t('roulette.spinFailed', 'Spin failed. Try again.');
      });
  }

  function highlightWinners(data) {
    betCells.forEach(cell => {
      const type = cell.dataset.type;
      const value = cell.dataset.value;
      const key = `${type}:${value}`;
      if (!bets[key]) return;
      let win = false;
      if (type === 'number') win = value === String(data.result_number);
      if (type === 'color') win = value === data.result_color;
      if (type === 'parity') win = value === data.result_parity;
      if (type === 'range') win = value === data.result_range;
      if (type === 'dozen') win = value === data.result_dozen;
      if (type === 'column') win = value === data.result_column;
      if (win) cell.classList.add('win');
    });
  }

  function pushHistory(number, color) {
    const item = document.createElement('span');
    item.classList.add(color);
    item.textContent = number;
    historyBox.prepend(item);
    while (historyBox.children.length > 10) {
      historyBox.removeChild(historyBox.lastChild);
    }
  }

  document.getElementById('spin-btn').addEventListener('click', spinWheel);
</script>
<script>
  const SHOW_TUTORIAL = overlay.dataset.show === 'true';
  const tutorialStepsByLang = {
    en: [
      'Select a chip value, then tap a bet area.',
      'Use the chips bar to change your bet size.',
      'Press Spin Wheel to start the round.',
      'Winning bets glow and your balance updates.'
    ],
    de: [
      'Wahle einen Chip und tippe auf ein Einsatzfeld.',
      'Nutze die Chips unten, um deinen Einsatz zu andern.',
      'Drucke Spin Wheel, um die Runde zu starten.',
      'Gewinnende Einsatze leuchten auf und dein Guthaben aktualisiert sich.'
    ]
  };
  let tutorialIndex = 0;

  const overlay = document.getElementById('tutorial-overlay');
  const text = document.getElementById('tutorial-text');
  const nextBtn = document.getElementById('tutorial-next');
  const closeBtn = document.getElementById('tutorial-close');
  const title = document.getElementById('tutorial-title');
  const tutorialBtn = document.getElementById('tutorial-btn');

  function showTutorial() {
    const t = window.getTranslation || ((key, fallback) => fallback || key);
    const lang = window.currentLang || 'en';
    const steps = tutorialStepsByLang[lang] || tutorialStepsByLang.en;
    title.textContent = lang === 'de' ? 'Willkommen bei Roulette' : 'Welcome to Roulette';
    text.textContent = steps[tutorialIndex];
    closeBtn.textContent = t('tutorial.close', 'Close');
    nextBtn.textContent = t('tutorial.next', 'Next');
    overlay.style.display = 'flex';
  }

  function closeTutorial() {
    overlay.style.display = 'none';
    tutorialIndex = 0;
  }

  if (tutorialBtn) {
    tutorialBtn.addEventListener('click', () => {
      tutorialIndex = 0;
      showTutorial();
    });
  }

  nextBtn.addEventListener('click', () => {
    tutorialIndex += 1;
    const lang = window.currentLang || 'en';
    const steps = tutorialStepsByLang[lang] || tutorialStepsByLang.en;
    if (tutorialIndex >= steps.length) {
      closeTutorial();
    } else {
      text.textContent = steps[tutorialIndex];
    }
  });

  closeBtn.addEventListener('click', closeTutorial);
</script>
{% endblock %}
